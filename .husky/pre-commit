#!/bin/sh

# ============================================================
# PRE-COMMIT HOOK
# ============================================================
# To skip these checks (use sparingly):
#   git commit --no-verify -m "your message"
#   OR: git commit -n -m "your message"
#   OR: SKIP_HOOKS=1 git commit -m "your message"
# ============================================================

# Allow skipping via environment variable
if [ "$SKIP_HOOKS" = "1" ] || [ "$SKIP_PRECOMMIT" = "1" ]; then
  echo "â­ï¸  Skipping pre-commit hooks (SKIP_HOOKS=1)"
  exit 0
fi

# Skip for merge commits
if [ -f .git/MERGE_HEAD ]; then
  echo "â­ï¸  Skipping pre-commit hooks (merge commit)"
  exit 0
fi

echo "ğŸ” Running pre-commit checks..."
echo "   (Use 'git commit -n' or SKIP_HOOKS=1 to skip)"
echo ""

# Run lint-staged (ESLint on staged files)
echo "ğŸ“ Linting staged files..."
npx lint-staged

# Type check (fast, catches type errors)
echo "ğŸ”· Type checking..."
npm run typecheck

# Run unit tests on affected files
echo "ğŸ§ª Running unit tests..."
npm run test:run -- --passWithNoTests

echo ""
echo "âœ… Pre-commit checks passed!"
